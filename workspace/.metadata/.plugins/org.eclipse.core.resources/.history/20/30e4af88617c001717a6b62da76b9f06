package persistacq;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.List;

import javax.swing.JTextField;

import calibration.LensInfo;

public class AcqPersist {
	
	public AcqPersist() {
	}

	public void saveParams(String fileName, Object[] objs) throws Exception {
		
		List<AcqParam> params = new ArrayList<AcqParam>();
		
		for(Object o : objs) {
			Field[] fields = o.getClass().getDeclaredFields();
			for(Field f : fields) {
				f.setAccessible(true);
				Class type = f.getType();
				PersistAcq param = f.getAnnotation(PersistAcq.class);
				if(param != null) {
					String id = param.id();		
					Object data = null;
					// If its a JTextField, just save the String content
					if(type == JTextField.class) {
						data = ((JTextField)f.get(o)).getText();						
					}				
					AcqParam p = new AcqParam(id, data);
					params.add(p);
				}
				
			}
		}
		
		//persist list
		FileOutputStream fileOut = new FileOutputStream("C:\\Users\\Maryana\\Desktop\\test_stitch\\params.ser");
		ObjectOutputStream out = new ObjectOutputStream(fileOut);
		out.writeObject(params);
		out.close();
		fileOut.close();
		
		//read list
        FileInputStream fileIn = new FileInputStream("C:\\Users\\Maryana\\Desktop\\test_stitch\\params.ser");
        ObjectInputStream in = new ObjectInputStream(fileIn);
        List<AcqParam> l = (List<AcqParam>) in.readObject();
        in.close();
        fileIn.close();
        
        for(AcqParam ap: l) {
        	Object d = ap.getData();
        	String id = ap.getId();
        	Class c = d.getClass();
        	System.out.println(c.getName());
        }
        
	}
	
}
