package persistacq;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.List;

import calibration.LensInfo;

public class AcqPersist {
	
	public AcqPersist() {
	}

	public void saveParams(String fileName, Object[] objs) throws Exception {
		
		List<AcqParam> params = new ArrayList<AcqParam>();
		
		for(Object o : objs) {
			Field[] fields = o.getClass().getDeclaredFields();
			for(Field f : fields) {
				Class type = f.getType();
				String name = f.getName();
				PersistAcq param = f.getAnnotation(PersistAcq.class);
				if(param != null) {
					String id = param.id();
					Object data = null;
					f.setAccessible(true);
					if(type == LensInfo.class) {
						data = f.get(o);						
					}
					AcqParam p = new AcqParam(id, data);
					params.add(p);
				}
				
			}
		}
		
		//persist list
		FileOutputStream fileOut = new FileOutputStream("C:\\params.ser");
		ObjectOutputStream out = new ObjectOutputStream(fileOut);
		out.writeObject(params);
		out.close();
		fileOut.close();
		
		//read list
        FileInputStream fileIn = new FileInputStream("C:\\params.ser");
        ObjectInputStream in = new ObjectInputStream(fileIn);
        List<AcqParam> l = (List<AcqParam>) in.readObject();
        in.close();
        fileIn.close();
	}
	
}
